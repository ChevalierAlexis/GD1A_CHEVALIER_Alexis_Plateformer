<!doctype html>
    <html lang="en">
        <head>
            <meta charset="UTF-8" /><title>Proto plateformer</title>
            <script src="phaser.min.js"></script>
            <style type="text/css"> body { margin: 0; }</style>
        </head>
        <body>
            <script type="text/javascript">
                class sceneBase extends Phaser.Scene{
                    constructor(){
                        super("sceneBase");
                    }
                
                preload(){
                this.load.image('sky', 'assets/sky.png');
                this.load.image('ground', 'assets/platform.png');
                this.load.image('star', 'assets/star.png');
                this.load.image('bomb', 'assets/bomb.png');
                this.load.image('bullet', 'assets/bullet.png');
                this.load.image('PM', 'assets/PlateformeMov.png');

                this.load.spritesheet('aerotroll','assets/aerotroll.png',
                { frameWidth: 64, frameHeight: 86 });
                this.load.spritesheet('troll','assets/troll.png',
                { frameWidth: 64, frameHeight: 54 });
                this.load.spritesheet('gattroll','assets/gattroll.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('trolleur_delite','assets/trolleur-delite.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('perso','assets/Chad.png',
                { frameWidth: 64, frameHeight: 64 });
                this.load.spritesheet('punch','assets/punch.png',
                { frameWidth: 34, frameHeight: 25 });

                this.load.image("tileset", "assets/tilesetblock.png");
                this.load.image("decor", "assets/Decors.png");
                this.load.tilemapTiledJSON("map", "maptest.json");
                }
                
                create(){

                    this.add.image(400, 300, 'sky');
                    this.platforms = this.physics.add.staticGroup();
                    this.platforms.create(400, 568, 'ground').setScale(2).refreshBody();
                    this.platforms.create(600, 400, 'ground');
                    this.platforms.create(50, 250, 'ground');
                    this.platforms.create(750, 220, 'ground');
                    this.cameras.main.centerOn(960,5920)
                    
                    this.over=false;
                    this.score = 0;
                    this.gameOver = false;
                    this.bullets;
                    this.speed;
                    this.stats;
                    this.lastFired = 0;
                    this.mousePointer;
                    this.memx = 0;
                    this.memy = 0;
                    this.pv = 3;
                    this.dir = 0
                    this.disPoing = false
                    this.hitbox;
                    this.pActif = false
                    this.offpoings = -30
                    this.bActive = false;
                    this.nbRebond = 0;
                    this.invin = false;
                    this.palier1 = true
                    this.palier1f = false
                    this.palier2 = false
                    this.palier2f = false
                    this.palier3 = false
                    this.palier3f = false
                    
                    this.keyZ;
                    this.keyQ;
                    this.keyS;
                    this.keyD;
                    this.keySpace;
                    
                    


                    const carteNiveau = this.add.tilemap("map");

                    const tileset = carteNiveau.addTilesetImage(
                        "tilesetblock",
                        "tileset"
                    )

                    const decors = carteNiveau.addTilesetImage(
                        "Decors",
                        "decor"
                    )

                    const sol = carteNiveau.createLayer(
                        "Blocs",
                        tileset
                    )
                    sol.setCollisionByProperty({ solide: true });

                    const border = carteNiveau.createLayer(
                        "Border",
                        tileset
                    )
                    border.setCollisionByProperty({ solide: true });

                    const piques = carteNiveau.createLayer(
                        "Piques",
                        tileset
                    )
                    piques.setCollisionByProperty({ pique: true });

                    const skin = carteNiveau.createLayer(
                        "Skin",
                        decors
                    )
  
                            
                    this.player = this.physics.add.sprite(110,6200, 'perso');

                    this.poings = this.physics.add.sprite(this.player.x+30,this.player.y, 'punch');
                    this.poings.enableBody(true)
                    
                    this.poings.body.allowGravity=false;



                    
                    this.test = this.physics.add.sprite(993, 5345, 'PM').setInteractive().setImmovable();
                    
                    this.test.body.allowGravity=false;
                    this.test.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test);
                    this.physics.add.collider(this.player, this.test);
                    this.physics.add.collider(this.test, this.platforms)
                    this.physics.add.collider(this.test, sol);

                    this.test2 = this.physics.add.sprite(800, 3875, 'PM').setInteractive().setImmovable();
                    
                    this.test2.body.allowGravity=false;
                    this.test2.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test2.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test2);
                    this.physics.add.collider(this.player, this.test2);
                    this.physics.add.collider(this.test2, this.platforms)
                    this.physics.add.collider(this.test2, sol);

                    this.test3 = this.physics.add.sprite(1310, 6175, 'PM').setInteractive().setImmovable();
                    
                    this.test3.body.allowGravity=false;
                    this.test3.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test3.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test3);
                    this.physics.add.collider(this.player, this.test3);
                    this.physics.add.collider(this.test3, this.platforms)
                    this.physics.add.collider(this.test3, sol);

                    this.test4 = this.physics.add.sprite(96, 5728, 'PM').setInteractive().setImmovable();
                    
                    this.test4.body.allowGravity=false;
                    this.test4.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test4.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test4);
                    this.physics.add.collider(this.player, this.test4);
                    this.physics.add.collider(this.test4, this.platforms)
                    this.physics.add.collider(this.test4, sol);

                    this.test5 = this.physics.add.sprite(1057, 5600, 'PM').setInteractive().setImmovable();
                    
                    this.test5.body.allowGravity=false;
                    this.test5.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test5.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test5);
                    this.physics.add.collider(this.player, this.test5);
                    this.physics.add.collider(this.test5, this.platforms)
                    this.physics.add.collider(this.test5, sol);

                    this.test6 = this.physics.add.sprite(1825, 5447, 'PM').setInteractive().setImmovable();
                    
                    this.test6.body.allowGravity=false;
                    this.test6.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test6.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test6);
                    this.physics.add.collider(this.player, this.test6);
                    this.physics.add.collider(this.test6, this.platforms)
                    this.physics.add.collider(this.test6, sol);

                    this.test7 = this.physics.add.sprite(865, 4832, 'PM').setInteractive().setImmovable();
                    
                    this.test7.body.allowGravity=false;
                    this.test7.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test7.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test7);
                    this.physics.add.collider(this.player, this.test7);
                    this.physics.add.collider(this.test7, this.platforms)
                    this.physics.add.collider(this.test7, sol);

                    this.test8 = this.physics.add.sprite(1055, 4832, 'PM').setInteractive().setImmovable();
                    
                    this.test8.body.allowGravity=false;
                    this.test8.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test8.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test8);
                    this.physics.add.collider(this.player, this.test8);
                    this.physics.add.collider(this.test8, this.platforms)
                    this.physics.add.collider(this.test8, sol);

                    this.test9 = this.physics.add.sprite(1505, 4832, 'PM').setInteractive().setImmovable();
                    
                    this.test9.body.allowGravity=false;
                    this.test9.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test9.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test9);
                    this.physics.add.collider(this.player, this.test9);
                    this.physics.add.collider(this.test9, this.platforms)
                    this.physics.add.collider(this.test9, sol);

                    this.test10 = this.physics.add.sprite(1632, 4960, 'PM').setInteractive().setImmovable();
                    
                    this.test10.body.allowGravity=false;
                    this.test10.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test10.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test10);
                    this.physics.add.collider(this.player, this.test10);
                    this.physics.add.collider(this.test10, this.platforms)
                    this.physics.add.collider(this.test10, sol);

                    this.test11 = this.physics.add.sprite(1760, 4832, 'PM').setInteractive().setImmovable();
                    
                    this.test11.body.allowGravity=false;
                    this.test11.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test11.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test11);
                    this.physics.add.collider(this.player, this.test11);
                    this.physics.add.collider(this.test11, this.platforms)
                    this.physics.add.collider(this.test11, sol);

                    this.test12 = this.physics.add.sprite(542, 3936, 'PM').setInteractive().setImmovable();
                    
                    this.test12.body.allowGravity=false;
                    this.test12.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test12.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test12);
                    this.physics.add.collider(this.player, this.test12);
                    this.physics.add.collider(this.test12, this.platforms)
                    this.physics.add.collider(this.test12, sol);

                    this.test13 = this.physics.add.sprite(352, 3103, 'PM').setInteractive().setImmovable();
                    
                    this.test13.body.allowGravity=false;
                    this.test13.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test13.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test13);
                    this.physics.add.collider(this.player, this.test13);
                    this.physics.add.collider(this.test13, this.platforms)
                    this.physics.add.collider(this.test13, sol);

                    this.test14 = this.physics.add.sprite(927, 3250, 'PM').setInteractive().setImmovable();
                    
                    this.test14.body.allowGravity=false;
                    this.test14.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test14.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test14);
                    this.physics.add.collider(this.player, this.test14);
                    this.physics.add.collider(this.test14, this.platforms)
                    this.physics.add.collider(this.test14, sol);

                    this.test15 = this.physics.add.sprite(990, 3250, 'PM').setInteractive().setImmovable();
                    
                    this.test15.body.allowGravity=false;
                    this.test15.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test15.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test15);
                    this.physics.add.collider(this.player, this.test15);
                    this.physics.add.collider(this.test15, this.platforms)
                    this.physics.add.collider(this.test15, sol);

                    this.test16 = this.physics.add.sprite(1568, 3105, 'PM').setInteractive().setImmovable();
                    
                    this.test16.body.allowGravity=false;
                    this.test16.on('pointerover', function () {
                        this.setTint(0x000000);
                    });
                    this.test16.on('pointerout', function () {
                        this.clearTint();
                    });
                    this.input.setDraggable(this.test16);
                    this.physics.add.collider(this.player, this.test16);
                    this.physics.add.collider(this.test16, this.platforms)
                    this.physics.add.collider(this.test16, sol);








                    this.keyZ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Z);
                    this.keyQ = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.Q);
                    this.keyS = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.S);
                    this.keyD = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.D);
                    this.keySpace = this.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes.SPACE);         

                    
    
                    this.physics.add.collider(this.player, this.platforms);

                    this.physics.add.collider(this.player, sol);
     
                    
        
                        
                    this.anims.create({
                    key: 'left',
                    frames: this.anims.generateFrameNumbers({ key: 'perso', frame: 0 }),
                    frameRate: 10,
                    repeat: -1
                    });
                    this.anims.create({
                    key: 'turn',
                    frames: [ { key: 'perso', frame: 0 } ],
                    frameRate: 20
                    });
                    this.anims.create({
                    key: 'right',
                    frames: this.anims.generateFrameNumbers({ key: 'perso', frame: 0 }),
                    frameRate: 10,
                    repeat: -1
                    });
                    
                    this.scoreText=this.add.text(16,16,'score: 0',{fontSize:'32px',fill:'#000'});
                    this.stars = this.physics.add.group({
                        key: 'star', repeat: 11,
                        setXY: { x: 12, y: 0, stepX: 70 }
                    });
                    this.stars.children.iterate(function (child) {
                        child.setBounceY(Phaser.Math.FloatBetween(0.4, 0.8));
                    });
                    this.physics.add.collider(this.stars, this.platforms);
                    this.physics.add.overlap(this.player, this.stars, collectStar, null, this);
                    // this.physics.add.overlap(this.test3, this.platforms, superposition,null,this);
                    // this.physics.add.overlap(this.test3, sol, superposition,null,this);
                    this.bombs = this.physics.add.group();
                    this.physics.add.collider(this.bombs, this.platforms);

                    this.input.on('drag', function (pointer, gameObject, dragX, dragY) {
                        gameObject.x = dragX;
                        gameObject.y = dragY;
                    });


                    this.ennemis1 = this.physics.add.group();
                    this.ennemi1 = this.physics.add.sprite(700,5800,'troll');
                    this.ennemi1.plat = 5
                    this.ennemi1.dir = "D"
                    this.ennemi1.spawnx = 700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(400,5800,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1057,5530,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(700,5600,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1250,5400,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(800,5400,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(800,5200,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(230,5250,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1400,4900,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1760,4750,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1550,4650,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(1565,3175,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(350,3175,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(960,3175,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(960,3050,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)

                    this.ennemi1 = this.physics.add.sprite(700,3250,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)
                    

                    this.ennemi1 = this.physics.add.sprite(480,3335,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)
                    

                    this.ennemi1 = this.physics.add.sprite(1185,3335,'troll'); 
                    this.ennemi1.plat = 2 
                    this.ennemi1.spawnx = 1700
                    this.ennemi1.agro = false
                    this.ennemi1.setSize(64,54)
                    this.ennemis1.add(this.ennemi1);
                    this.ennemis1.enableBody = true
                    this.ennemi1.setPushable(false)
                    




                    this.physics.add.collider(this.player,this.ennemis1, degat, null, this);
                    this.physics.add.collider(this.ennemis1, sol);
                    this.physics.add.collider(this.ennemis1, piques, paf, null, this);
                    this.physics.add.collider(this.ennemis1, this.test);
                    this.physics.add.collider(this.ennemis1, this.test2);
                    this.physics.add.collider(this.ennemis1, this.test3);
                    this.physics.add.collider(this.ennemis1, this.test4);
                    this.physics.add.collider(this.ennemis1, this.test5);
                    this.physics.add.collider(this.ennemis1, this.test6);
                    this.physics.add.collider(this.ennemis1, this.test7);
                    this.physics.add.collider(this.ennemis1, this.test8);
                    this.physics.add.collider(this.ennemis1, this.test9);
                    this.physics.add.collider(this.ennemis1, this.test10);
                    this.physics.add.collider(this.ennemis1, this.test11);
                    this.physics.add.collider(this.ennemis1, this.test12);
                    this.physics.add.collider(this.ennemis1, this.test13);
                    this.physics.add.collider(this.ennemis1, this.test14);
                    this.physics.add.collider(this.ennemis1, this.test15);
                    this.physics.add.collider(this.ennemis1, this.test16);
                    this.physics.add.collider(this.ennemis1, border);


                    
                    this.ennemis2 = this.physics.add.group();
                    this.ennemi2 = this.physics.add.sprite(1180,4750,'trolleur_delite');
                    this.ennemi2.agro = false
                    this.ennemis2.add(this.ennemi2);
                    this.ennemis2.enableBody = true
                    this.ennemi2.setPushable(false)
                    this.tir = this.physics.add.group();
                    this.tir.enableBody = true
                    this.tir.allowGravity=false

                    // this.ennemi2 = this.physics.add.sprite(1760,4550,'trolleur_delite');
                    // this.ennemi2.agro = false
                    // this.ennemis2.add(this.ennemi2);
                    // this.ennemis2.enableBody = true
                    // this.ennemi2.setPushable(false)

                    // this.ennemi2 = this.physics.add.sprite(800,2850,'trolleur_delite');
                    // this.ennemi2.agro = false
                    // this.ennemis2.add(this.ennemi2);
                    // this.ennemis2.enableBody = true
                    // this.ennemi2.setPushable(false)

                    // this.ennemi2 = this.physics.add.sprite(1120,2850,'trolleur_delite');
                    // this.ennemi2.agro = false
                    // this.ennemis2.add(this.ennemi2);
                    // this.ennemis2.enableBody = true
                    // this.ennemi2.setPushable(false)
                            
                    
                    this.physics.add.collider(this.player,this.ennemis2, degat, null, this);
                    this.physics.add.collider(this.ennemis2, sol);
                    this.physics.add.collider(this.ennemis2, this.test);
                    this.physics.add.collider(this.ennemis2, this.test2);
                    this.physics.add.collider(this.ennemis2, this.test3);
                    this.physics.add.collider(this.ennemis2, this.test4);
                    this.physics.add.collider(this.ennemis2, this.test5);
                    this.physics.add.collider(this.ennemis2, this.test6);
                    this.physics.add.collider(this.ennemis2, this.test7);
                    this.physics.add.collider(this.ennemis2, this.test8);
                    this.physics.add.collider(this.ennemis2, this.test9);
                    this.physics.add.collider(this.ennemis2, this.test10);
                    this.physics.add.collider(this.ennemis2, this.test11);
                    this.physics.add.collider(this.ennemis2, this.test12);
                    this.physics.add.collider(this.ennemis2, this.test13);
                    this.physics.add.collider(this.ennemis2, this.test14);
                    this.physics.add.collider(this.ennemis2, this.test15);
                    this.physics.add.collider(this.ennemis2, this.test16);
                    this.physics.add.collider(this.ennemis2, piques);
                    this.physics.add.collider(this.ennemis2, border);
                    this.physics.add.collider(this.tir, this.player, degat, null, this);
                    this.physics.add.collider(this.tir,sol, rebond, null, this);
                    this.physics.add.collider(this.tir, this.platforms,rebond, null, this);
                    this.physics.add.collider(this.tir,this.test, rebond, null, this);



                    this.ennemis3 = this.physics.add.group();
                    this.ennemi3 = this.physics.add.sprite(1300,5625,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemis3.allowGravity=false
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(1825,5500,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(990,5250,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(400,5000,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(1400,4800,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(1650,4800,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(1400,3200,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(535,3200,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(835,3300,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.ennemi3 = this.physics.add.sprite(1100,3300,'aerotroll');
                    this.ennemi3.spawny = 6000
                    this.ennemi3.dir = 1
                    this.ennemi3.agro = false
                    this.ennemis3.add(this.ennemi3);
                    this.ennemis3.enableBody = true
                    this.ennemi3.setPushable(false)
                    this.ennemi3.setVelocityY(-1)

                    this.physics.add.collider(this.player,this.ennemis3, degat, null, this);
                    this.physics.add.collider(this.ennemis3, sol,changeDir,null,this);
                    this.physics.add.collider(this.ennemis3, this.platforms);
                    this.physics.add.collider(this.ennemis3, piques, paf, null, this);
                    this.physics.add.collider(this.ennemis3, border);
                    this.physics.add.collider(this.ennemis3, this.test);
                    this.physics.add.collider(this.ennemis3, this.test2);
                    this.physics.add.collider(this.ennemis3, this.test3);
                    this.physics.add.collider(this.ennemis3, this.test4);
                    this.physics.add.collider(this.ennemis3, this.test5);
                    this.physics.add.collider(this.ennemis3, this.test6);
                    this.physics.add.collider(this.ennemis3, this.test7);
                    this.physics.add.collider(this.ennemis3, this.test8);
                    this.physics.add.collider(this.ennemis3, this.test9);
                    this.physics.add.collider(this.ennemis3, this.test10);
                    this.physics.add.collider(this.ennemis3, this.test11);
                    this.physics.add.collider(this.ennemis3, this.test12);
                    this.physics.add.collider(this.ennemis3, this.test13);
                    this.physics.add.collider(this.ennemis3, this.test14);
                    this.physics.add.collider(this.ennemis3, this.test15);
                    this.physics.add.collider(this.ennemis3, this.test16);

                    this.ennemis4 = this.physics.add.group();
                    this.ennemi4 = this.physics.add.sprite(1825,2850,'gattroll');
                    this.ennemi4.agro = false
                    this.ennemis4.add(this.ennemi4);
                    this.ennemis4.enableBody = true
                    this.ennemi4.setPushable(false)
                    this.tir2 = this.physics.add.group();
                    this.tir2.enableBody = true
                    this.tir2.allowGravity=false

                    this.ennemi4 = this.physics.add.sprite(95,2850,'gattroll');
                    this.ennemi4.agro = false
                    this.ennemis4.add(this.ennemi4);
                    this.ennemis4.enableBody = true
                    this.ennemi4.setPushable(false)


                    this.ennemi4 = this.physics.add.sprite(160,3675,'gattroll');
                    this.ennemi4.agro = false
                    this.ennemis4.add(this.ennemi4);
                    this.ennemis4.enableBody = true
                    this.ennemi4.setPushable(false)


                    this.ennemi4 = this.physics.add.sprite(1055,4100,'gattroll');
                    this.ennemi4.agro = false
                    this.ennemis4.add(this.ennemi4);
                    this.ennemis4.enableBody = true
                    this.ennemi4.setPushable(false)

                    this.physics.add.collider(this.player,this.ennemis4, degat, null, this);
                    this.physics.add.collider(this.ennemis4, sol);
                    this.physics.add.collider(this.ennemis4, piques);
                    this.physics.add.collider(this.ennemis4, border);
                    this.physics.add.collider(this.ennemis4, this.test);
                    this.physics.add.collider(this.ennemis4, this.test2);
                    this.physics.add.collider(this.ennemis4, this.test3);
                    this.physics.add.collider(this.ennemis4, this.test4);
                    this.physics.add.collider(this.ennemis4, this.test5);
                    this.physics.add.collider(this.ennemis4, this.test6);
                    this.physics.add.collider(this.ennemis4, this.test7);
                    this.physics.add.collider(this.ennemis4, this.test8);
                    this.physics.add.collider(this.ennemis4, this.test9);
                    this.physics.add.collider(this.ennemis4, this.test10);
                    this.physics.add.collider(this.ennemis4, this.test11);
                    this.physics.add.collider(this.ennemis4, this.test12);
                    this.physics.add.collider(this.ennemis4, this.test13);
                    this.physics.add.collider(this.ennemis4, this.test14);
                    this.physics.add.collider(this.ennemis4, this.test15);
                    this.physics.add.collider(this.ennemis4, this.test16);
                    this.physics.add.collider(this.tir2, this.player, degat, null, this);
                    this.physics.add.collider(this.tir2,sol, rebond, null, this);
                    this.physics.add.collider(this.tir2, this.platforms,rebond, null, this);
                    this.physics.add.collider(this.tir2,this.test, rebond, null, this);
                    
                };
                
                update(time,delta){
                    // console.log(this.player.x)
                    // console.log(this.player.y)
                    this.over=false
                    this.poings.x = this.player.x + this.offpoings
                    this.poings.y = this.player.y + 20
                    this.test.setVelocity(0);
                    if (this.gameOver){return;}

                    if (this.keyQ.isDown){
                        this.player.setVelocityX(-160);
                        if (this.dir == 0){
                            this.dir = 1
                            this.player.flipX = false
                            this.poings.flipX = false
                            this.offpoings = -30
                        }
                    }

                    else if (this.keyD.isDown) {
                        this.player.setVelocityX(160);
                        if (this.dir == 1){
                            this.dir = 0
                            this.player.flipX = true
                            this.poings.flipX = true
                            this.offpoings = 30
                        } 

                    }
                    
                    else{
                        this.player.setVelocityX(0);
                        // this.player.anims.play('turn'); 
                    }
                    console.log(this.bActive)
                    if (this.keyZ.isDown && this.player.body.onFloor()) {
                            this.player.setVelocityY(-225);  
                    }

                    if (this.keySpace.isDown) {
                        this.pActif = true
                        if (this.disPoing = true){
                            this.hitbox = this.physics.add.collider(this.poings, this.ennemis1, paf, null, this);
                            this.disPoing = false
                        }
                    }
                    
                    if (this.keySpace.isUp) {
                        
                        if (this.disPoing = false){
                            this.physics.world.remove.collider(this.hitbox);
                            this.disPoing = true
                        }
                    }

                    

                    if (this.nbRebond>=10){
                        this.balle.destroy();
                        this.bActive = false
                    }

                    if (this.player.y<5500){
                        this.palier1 = true
                    }

                    if (this.player.y<4540){
                        this.palier2 = true
                        this.palier1= false
                    }

                    if (this.player.y<3616){
                        this.palier3 = true
                        this.palier2= false
                    }

                    if (this.palier3 == true && this.palier3f == false){
                        this.cameras.main.centerOn(960,3160)
                        this.player.setX(300)
                        this.player.setY(3480)
                        this.palier3f=true
                    }
                    else if (this.palier2 == true && this.palier2f == false){
                        this.cameras.main.centerOn(960,4060)
                        this.player.setX(1580)
                        this.player.setY(4440)
                        this.palier2f=true
                    }
                    else if (this.palier1 == true && this.palier1f == false){
                        this.cameras.main.centerOn(960,5000)
                        this.player.setX(1580)
                        this.player.setY(5400)
                        this.palier1f=true
                    }

                    

                    this.ennemis1.children.iterate(function (child){
                        if (this.player.x>child.x) {
                            child.setVelocityX(30);
                        }
                        if (this.player.x<child.x){
                                child.setVelocityX(-30);
                            }

                    },this)

                    this.ennemis2.children.iterate(function (child){
                        child.setVelocityX(-1)
                        while (child.x>this.player.x && this.bActive==false){
                            console.log ("spot")
                            child.agro = true
                            this.balle = this.physics.add.sprite(child.x-100,child.y, 'bullet');
                            this.tir.add(this.balle);
                            
                            this.bActive = true
                            this.balle.setBounce(1); 
                            this.physics.moveTo(this.balle,child.x-3000,child.y+10,2000)
                            this.balle.setCollideWorldBounds(true);
                        }
                    },this)

                    this.ennemis3.children.iterate(function (child){
                       if (child.dir==1) {
                            child.setVelocityY(-30)
                       }
                       if (child.dir==0) {
                        child.setVelocityY(30)   
                       }
                    },this)

                    this.ennemis4.children.iterate(function (child){
                        child.setVelocityX(-1)
                        while (child.x<this.player.x && this.bActive2==false){
                            child.agro2 = true
                            this.balle2 = this.physics.add.sprite(child.x,child.y, 'bullet');
                            this.bActive2 = true
                            this.tir2.add(this.balle2);
                            
                            
                            this.balle2.setBounce(1);   
                            this.physics.moveToObject(this.balle2, this.player,200)
                            this.balle2.setCollideWorldBounds(true);
                        }
                    },this)
                }}
                class menu extends Phaser.Scene {
            constructor() {
                super("menu");
            }
            preload(){
                this.load.image('menu', 'assets/menu.png');
            }
            create(){
                const ecranMenu = this.add.sprite(960, 470, 'menu')
                    .setInteractive()
	                .on('pointerdown', () => this.scene.start("sceneBase"))
                function lancer() {
                    this.scene.start("sceneBase");
                };
            }
        }
        
                var config = {
                type: Phaser.CANVAS,
                width: 1920, height: 940, //,940
                backgroundColor: '#FFC8BC',
                pixelArt : true,
                physics: {
                        default: 'arcade',
                        arcade: {
                            gravity: { y: 300 },
                            debug: false,
                        }},
                scene: [menu,sceneBase]
                };
                new Phaser.Game(config);

                function mort(player){
                    if (this.palier3==true){
                        player.setX(1580)
                        player.setY(5400)
                        this.pv = 3
                    }
                    else if (this.palier2==true){
                        player.setX(1580)
                        player.setY(5400)
                        this.pv = 3
                    }
                    else if (this.palier1==true){
                        player.setX(1580)
                        player.setY(5400)
                        this.pv = 3
                    }
                    else{
                        player.setX(110)
                        player.setY(6000)
                        this.pv = 3
                    }
                }
                function superposition(test, platforms){
                    this.input.setDragState(this.input.activePointer, 0);
                    test.x = this.memx;
                    test.y = this.memy;
                }

                function paf(monstre){
                  
                    monstre.disableBody(true,true);
                }

                function degat(player, ennemis1){
                    
                    if (this.invin == false)
                        this.pv = this.pv-1
                        this.invin = true
                        this.player.alpha = 0.5
                        this.frameinvin = this.time.addEvent({
                            delay: 1500,
                            callback: ()=>{
                           
                                this.invin = false
                                this.player.alpha = 1;
                            },
                        loop: false})
    
                    if (this.pv<=0){
                        mort(this.player)
                    }
                }

                function collectStar(player, star){
                    star.disableBody(true, true); 
                    this.score += 10;
                    this.scoreText.setText('Score: ' + this.score);
                    if (this.stars.countActive(true) === 0){
                    this.stars.children.iterate(function (child) {
                    child.enableBody(true, child.x, 0, true, true);
                    }); 
                    var x = (player.x < 400) ? Phaser.Math.Between(400, 800) :
                    Phaser.Math.Between(0, 400);
                    var bomb = this.bombs.create(x, 16, 'bomb');
                    bomb.setBounce(1);
                    bomb.setCollideWorldBounds(true);
                    bomb.setVelocity(Phaser.Math.Between(-200, 200), 20);
                    bomb.allowGravity = false; 
                    }
                }

                function rebond (){
                    this.nbRebond += 1
                }

                function changeDir(monstre){
                    if(monstre.dir==1){
                        monstre.dir=0
                    }
                    else{
                        monstre.dir=1
                    }
                }

                
            </script>
        </body>
    </html>